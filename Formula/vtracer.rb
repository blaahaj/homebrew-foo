class Vtracer < Formula
  desc "Convert raster images to SVG"
  homepage "https://github.com/visioncortex/vtracer"
  url "https://github.com/visioncortex/vtracer.git", tag: "0.6.5", revision:
    "6fdfec86109f6a94fd92a2ea64ddc8d03386779a"
  sha256 "fbfaf7438991e966b79d8382ae3e9eb001ac34f387d4fae73ece4d21cc6179bf"
  license ""

  depends_on "rust" => :build

  def install
    Dir.chdir "./cmdapp" do
      system "cargo", "install", *std_cargo_args
    end
  end

  test do
    require "tempfile"

    Dir.mktmpdir do |tmpdir|
      png_content = DATA.read.gsub("\n", "").unpack("m0")[0]
      File.write("#{tmpdir}/circle.png", png_content)

      system "vtracer -i circle.png -o circle.svg --mode polygon", chdir: tmpdir
      unless $?.success?
        raise "vtracer command failed (#{$?.inspect})"
      end

      svg_content = File.read("#{tmpdir}/circle.svg")
      unless svg_content.match?(/<\/svg>\s*\z/)
        raise "vtracer output file doesn't contain SVG"
      end
    end
  end
end

__END__
iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAw3pUWHRSYXcgcHJv
ZmlsZSB0eXBlIGV4aWYAAHjabVBbEsMgCPznFD2CPDR4HNOkM71Bj18UkolNd8YF
WWcFYP+8X/DoIBSQvGippSSDVKnULNHkaIMxyeCBIqHhXIdTICuxRfarlnh/1PE0
8NAsyxcjfYawzkKND0h/jMgD9456voVRDSMmFzAMWotRqi7XEdY9zVA/0El0bvt2
X2x7W7Z/mGhn5GTMrN4A9yPAzQQ0toI9TKyWZy6jcoxqC/m3pwPwBfFeWSIGmA7r
AAABg2lDQ1BJQ0MgcHJvZmlsZQAAeJx9kT1Iw0AcxV9TpaIVBzOIOGSoTnZR0Y5a
hSJUCLVCqw4ml35Bk4YkxcVRcC04+LFYdXBx1tXBVRAEP0CcHZwUXaTE/6WFFjEe
HPfj3b3H3TtAqJeZbnfNArrhWKlEXMpkV6XQK/ogIoQZxBRmm3OynITv+LpHgK93
UZ7lf+7P0a/lbAYEJOJZZloO8Qbx9KZjct4nFllR0YjPicctuiDxI9fVJr9xLngs
8EzRSqfmiUViqdDBagezoqUTTxFHNN2gfCHTZI3zFme9XGWte/IXhnPGyjLXaY4g
gUUsQYYEFVWUUIaDKK0GKTZStB/38Q97fplcKrlKYORYQAU6FM8P/ge/u7XzkxPN
pHAc6H5x3Y9RILQLNGqu+33suo0TIPgMXBltf6UOxD5Jr7W1yBEwsA1cXLc1dQ+4
3AGGnkzFUjwpSFPI54H3M/qmLDB4C/SuNXtr7eP0AUhTV8kb4OAQGCtQ9rrPu3s6
e/v3TKu/HxHVcuZtt9svAAANemlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94
cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQi
Pz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0i
WE1QIENvcmUgNC40LjAtRXhpdjIiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRw
Oi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRm
OkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wTU09Imh0dHA6
Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICB4bWxuczpzdEV2dD0iaHR0
cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgog
ICAgeG1sbnM6R0lNUD0iaHR0cDovL3d3dy5naW1wLm9yZy94bXAvIgogICAgeG1s
bnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1s
bnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICB4bWxu
czp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgIHhtcE1NOkRv
Y3VtZW50SUQ9ImdpbXA6ZG9jaWQ6Z2ltcDo3NWQwNGFjYi1hODkwLTRkNjItODAw
Ny01N2YwM2EyMmJlOGIiCiAgIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDU1
MjJiMmMtN2RmYi00OGQzLTg4M2MtZTg0NDIyZTZmMTk5IgogICB4bXBNTTpPcmln
aW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MGFjNzY4YzktOTI3Ny00Y2FkLThlY2Yt
ZTBjYzgwOTIyMDUxIgogICBHSU1QOkFQST0iMi4wIgogICBHSU1QOlBsYXRmb3Jt
PSJNYWMgT1MiCiAgIEdJTVA6VGltZVN0YW1wPSIxNzMyMDg5Mzg1OTc4NzUyIgog
ICBHSU1QOlZlcnNpb249IjIuMTAuMzgiCiAgIGRjOkZvcm1hdD0iaW1hZ2UvcG5n
IgogICB0aWZmOk9yaWVudGF0aW9uPSIxIgogICB4bXA6Q3JlYXRvclRvb2w9IkdJ
TVAgMi4xMCIKICAgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNDoxMToyMFQwODo1Njoy
NSswMTowMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQ6MTE6MjBUMDg6NTY6MjUr
MDE6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxy
ZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJzYXZlZCIKICAgICAgc3RFdnQ6Y2hh
bmdlZD0iLyIKICAgICAgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5MzljYzVl
Ny1lOTZjLTRkODMtODEzNy1jMzBmZGE5MWRlMTUiCiAgICAgIHN0RXZ0OnNvZnR3
YXJlQWdlbnQ9IkdpbXAgMi4xMCAoTWFjIE9TKSIKICAgICAgc3RFdnQ6d2hlbj0i
MjAyNC0xMS0yMFQwODo1NjoyNSswMTowMCIvPgogICAgPC9yZGY6U2VxPgogICA8
L3htcE1NOkhpc3Rvcnk+CiAgPC9yZGY6RGVzY3JpcHRpb24+CiA8L3JkZjpSREY+
CjwveDp4bXBtZXRhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgCjw/
eHBhY2tldCBlbmQ9InciPz7IM7yAAAADAFBMVEUAAAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/
AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAD/AAAx9SyrAAAAAXRSTlMAQObYZgAA
AAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfoCxQHOBno
08AoAAAArUlEQVRo3u3ZOQ6AMAwFUTT3PzQSFRViiUfB+XMAXhWR2NuWUkrpP3FU
/Plz9cJoh8sEYgwD5Qo3M4wPCo8yjHcK1CtQr0C9AoJiIFCvgKAYCNQrICgGAoLS
BgFBaYOAoARZEwFBCbIoksMYZPZf40K3lVxT5Wv9PI8g5TnX6PXrDAsazVacUZQz
VHPGg86g0xnZOsNnaYzuLASk1YazpJHWTdbizFoBppRSGt8OIjwfOf/6vT0AAAAA
SUVORK5CYII=
